<!DOCTYPE html>

<html>
  <head>
    <title>Jerry's Design</title>
    <meta
      charset="utf-8"
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <link rel="stylesheet" href="webmain.css" />
  </head>

  <body>
    <div id="UI">
      <canvas id="cava"></canvas>
    </div>

    <!-- Header -->
    <header id="header">
      <div class="logo"></div>
      <button id="btnMENU"><h3>&nbsp;≡&nbsp;</h3></button>
    </header>

    <!-- Nav -->
    <nav id="menu">
      <ul>
        <li><button class="avg1">First</button></li>
        <li><button class="avg1">Sec.</button></li>
        <li><button class="avg1">Trd.</button></li>
      </ul>
    </nav>

    <section id="topic">
      <button id="b1" class="avg3 searchButton">search</button>
      <button id="b2" class="avg3">pesona</button>
      <button id="b3" class="avg3">message</button>
    </section>

    <section id="banner"></section>
    <section id="post">
      <div class="inner box"></div>
    </section>
    <section id="post2">
      <div class="inner box"></div>
    </section>
    <section id="post3">
      <div class="inner box">
        <div class="inner box"></div>
      </div>
    </section>
    <footer id="footer">
      <button
        id="reset"
        style="position: absolute; left: 40%; top: -50%; width: 20%"
      >
        reset
      </button>
    </footer>
  </body>

  <script>
    var Color = new Array(5);
    Color[0] = "#E3A6A1"; //Blush
    Color[1] = "#BC5F6A"; //Berry
    Color[2] = "#19B3B1"; //Tiffany Blue
    Color[3] = "#034B61"; //Deep Teal
    Color[4] = "rgba(227, 166, 161, 1)"; //Blush
    Color[5] = "rgba(188, 95 , 106, 1)"; //Berry
    Color[6] = "rgba(25 , 179, 177, 1)"; //Tiffany Blue
    Color[7] = "rgba(3  , 75 , 97 , 1)"; //Deep Teal

    var canvas = document.getElementById("cava");
    var context = canvas.getContext("2d");

    function resize() {}
    var header = document.getElementById("header");
    var menu = document.getElementById("menu");
    var btnMENU = document.getElementById("btnMENU");
    var topic = document.getElementById("topic");
    var banner = document.getElementById("banner");
    var post = document.getElementById("post");
    var post2 = document.getElementById("post2");
    var post3 = document.getElementById("post3");
    var reset = document.getElementById("reset");

    window.onload = function () {
      preload();
    };

    function preload() {
      header.style.transition = "1s ease 0.5s";
      //menu.style.transition = "1s ease 0s";
      topic.style.transition = "1s ease 0s";
      banner.style.transition = "1s ease 0s";
      post.style.transition = "1s ease 1s";
      post2.style.transition = "1s ease 1.33s";
      post3.style.transition = "1s ease 1.66s";
      header.style.left = "0%";
      //menu.style.left = "0%";
      topic.style.left = "0%";
      banner.style.left = "0%";
      post.style.top = "0%";
      post2.style.top = "0%";
      post3.style.top = "0%";
    }

    function reload() {
      header.style.transition = "0s";
      //menu.style.transition = "0s";
      topic.style.transition = "0s";
      banner.style.transition = "0s";
      post.style.transition = "0s";
      post2.style.transition = "0s";
      post3.style.transition = "0s";

      header.style.left = "100%";
      //menu.style.left = "-50%";
      topic.style.left = "-100%";
      banner.style.left = "-100%";
      post.style.top = "70%";
      post2.style.top = "70%";
      post3.style.top = "70%";

      var until = setTimeout(preload, 200);
    }
    btnMENU.onclick = function () {
      if (menu.style.left == "0%") {
        menu.style.left = "-50%";
      } else {
        menu.style.left = "0%";
      }
    };
    var mx,
      my = 0;
    reset.onclick = function () {
      reload();
    };

    var b1 = document.getElementById("b1");
    var b2 = document.getElementById("b2");
    var b3 = document.getElementById("b3");

    var url = "action.php";

    b1.onclick = function () {
      var formData = new FormData();
      formData.append("userid", "01");
      formData.append("action", "search");
      formData.append("category", "food");
      postPHP(url, formData);
    };
    b2.onclick = function () {
      var formData = new FormData();
      formData.append("userid", "01");
      formData.append("action", "pesona");
      postPHP(url, formData);
    };
    // b3.onclick = function(){
    // 	var formData = new FormData();
    // 	formData.append('userid', '01');
    // 	formData.append('action', 'message');
    // 	postPHP(url, formData);
    // }
    function postPHP(URL, DATA) {
      fetch(URL, { method: "POST", body: DATA })
        .then(function (response) {
          return response.text();
        })
        .then(function (body) {
          console.log(body);
        });
    }
    //search button
    const searchButton = document.querySelector(".searchButton");
    console.log(searchButton);
    function scrollHandler() {
      let scrollY = window.scrollY;
      if (scrollY >= topic.offsetTop + topic.offsetHeight) {
        searchButton.classList.add("buttonTransform");
      } else {
        searchButton.classList.remove("buttonTransform");
      }
    }
    window.addEventListener("scroll", scrollHandler);
    b3.onclick = function () {
      // 發送 Ajax 查詢請求並處理
      var request = new XMLHttpRequest();
      request.open("GET", "service.php?number=" + 1);
      request.send();

      request.onreadystatechange = function () {
        // 伺服器請求完成
        if (request.readyState === 4) {
          // 伺服器回應成功
          console.log("伺服器回應成功", request);
          if (request.status === 200) {
            var type = request.getResponseHeader("Content-Type"); // 取得回應類型

            // 判斷回應類型，這裡使用 JSON
            if (type.indexOf("application/json") === 0) {
              console.log("取得JSON");
              var data = JSON.parse(request.responseText);

              if (data.number) {
                b3.innerHTML = "[找到員工] 員工編號：";
              } else {
                document.getElementById("searchResult").innerHTML = data.msg;
              }
            } else {
              console.log("這不是JSON");
              b3.innerHTML = "這不是JSON";
            }
          }
        }
      };
    };
  </script>
</html>
